# TOOD: make this a TPM plugin and make it more customizable
# Version 0.0
# Prefix!
unbind C-b
unbind C-a
set -g prefix F10
bind-key F10 last-window

# Faster vim!
set -s escape-time 0

# 256 colors
set -g default-terminal "screen-256color"

# Copy Vi mode!
set-window-option -g mode-keys vi
# 2.4 Major changes happened https://shapeshed.com/custom-vim-bindings-in-tmux-2-4/#enter-if-shell
run-shell "tmux setenv -g TMUX_VERSION $(tmux -V | cut -c 6-)"
if-shell -b '[ "$(echo "$TMUX_VERSION < 2.4" | bc)" = 1 ]' \
  "bind-key Escape copy-mode; \
  bind-key -t vi-copy Escape cancel; \
  bind-key -t vi-copy v begin-selection; \
  bind-key -t vi-copy V select-line; \
  bind-key -t vi-copy r rectangle-toggle; \
  bind-key -t vi-copy y copy-selection; \
  bind -t vi-copy x copy-pipe 'xclip -in -selection clipboard'"

if-shell -b '[ "$(echo "$TMUX_VERSION >= 2.4" | bc)" = 1 ]' \
  "bind-key -T copy-mode-vi 'v' send -X begin-selection; \
  bind-key -T copy-mode-vi 'V' send -X select-line; \
  bind-key -T copy-mode-vi 'r' send -X rectangle-toggle; \
  bind-key -T copy-mode-vi 'y' send -X copy-selection-and-cancel; \
  bind-key -T copy-mode-vi 'x' send -X copy-pipe-and-cancel 'xclip -in -selection clipboard'" 
# Notice for copy and script notification to work, MacOS should do: brew install reattach-to-user-namespace
# set-option -g default-command "reattach-to-user-namespace -l zsh"
# prefix+v to paste
unbind v
bind-key v paste-buffer
# find window fzf http://stackoverflow.com/questions/37730996/tmux-script-for-fast-window-switching-with-fzf-tmux-gives-me-the-wrong-options
unbind g
bind-key g run-shell "tmux list-windows -F \"##I:##W\" | fzf-tmux | cut -d \":\" -f 1 | xargs tmux select-window -t"
unbind f
bind-key f run "tmux split-window -l 12 'zsh -ci ftpane'"

# All for panel
set -g pane-base-index 1
setw -g automatic-rename on
set -g renumber-windows on
set -g display-panes-time 9999 # Hello! Wait for your input
# set status-interval 1 error on Centos
set -g set-titles on

# Statusline UI
set -g status-position top
set -g status-left '#{dustline_scheme_begin}'\
# '#[bold] #(whoami) '\
'#{dustline_scheme_separator}'\
# '#h'\
'#{dustline_scheme_end}'

#tmux set -g status-right '#{?client_prefix,#(tmux setw -g status-bg colour123), #(tmux setw -g status-bg colour192) }#{?client_prefix,#[bg=colour117],#[bg=colour192]}#[fg=colour238]#[reverse]#[noreverse]#[bold]CPU:#{cpu_percentage}#[fg=colour228]#[fg=colour232,bg=colour228,bold]#{online_status}#[fg=colour222]#[fg=colour232,bg=colour222,bold]#{battery_icon}#{battery_percentage}#[fg=colour216]#[fg=colour232,bg=colour216]%Y-%m-%d %a %H:%M '
set -g @dustline_scheme_file "wombat.tmux"

set -g status-right '#{dustline_scheme_begin}'\
'#[bold]#{cpu_percentage} '\
'#{dustline_scheme_separator}'\
'#{battery_icon}#{battery_percentage}'\
'#{dustline_scheme_separator}'\
'%Y-%m-%d %a %H:%M'\
'#{dustline_scheme_end}'

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
# Other examples:
# set -g @plugin 'github_username/plugin_name'
# set -g @plugin 'git@github.com/user/plugin'
# set -g @plugin 'git@bitbucket.com/user/plugin'
# A bunch of good stuff, first time use prefix+I to install all plugins
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-online-status'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tmux-net-speed'
set -g @plugin 'tmux-plugins/tmux-sidebar'
set -g @plugin 'tmux-plugins/tmux-pain-control'
set -g @plugin 'daizeng1984/tmux_wombat'

# Plugin setings

# Online ICON
set -g @online_icon "#[fg=colour034,bold]▲▼"
set -g @offline_icon "#[fg=colour196,bold]  "
# Battery status
set -g @batt_charged_icon "#[fg=colour034]"
set -g @batt_charging_icon "#[fg=colour232]"
set -g @batt_discharging_icon "#[fg=colour167]"
set -g @batt_attached_icon "#[fg=colour232]"

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
